Reordered the loops to remove the reduction.
The new code is faster on both the AMD and NVIDIA GPU-based systems,
but the overall impact on the CRAY-compiled code for the AMD GPUs is significantly larger.
